name: Release ğŸ·ï¸

on:
  push:
    tags:
      - "v?[0-9]+.[0-9]+.[0-9]+*"
  workflow_dispatch:
    inputs:
      tag:
        description: "The existing tag to publish"
        type: "string"
        required: true

jobs:
  publish-release:
    name: "Publish Release ğŸ“¤ï¸"
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v4
    - name: Publish release ${{ github.ref }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        gh release create "${{ github.ref }}" --draft --generate-notes
        if [ "$(gh release view "${{ github.ref }}" --json assets --template '{{len .assets}}')" -eq 0 ]; then
          exit 1
        fi
        gh release edit "${{ github.ref }}" --draft=false
